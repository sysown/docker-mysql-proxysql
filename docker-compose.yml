version: "2.0"
services:
  mysql1:
    image: "proxysql/galera:latest"
    build: ./conf/mysql
    ports:
      - "13306:3306"
    volumes:
      - ./conf/mysql/mysql1:/etc/mysql
    networks:
      - backend
    environment:
      - MYSQL_ROOT_PASSWORD=root
  mysql2:
    image: "proxysql/galera:latest"
    build: ./conf/mysql
    ports:
      - "13307:3306"
    volumes:
      - ./conf/mysql/mysql2:/etc/mysql
    networks:
      - backend
    depends_on:
      - mysql1
    environment:
      - MYSQL_ROOT_PASSWORD=root
  mysql3:
    image: "proxysql/galera:latest"
    build: ./conf/mysql
    ports:
      - "13308:3306"
    volumes:
      - ./conf/mysql/mysql3:/etc/mysql
    networks:
      - backend
    depends_on:
      - mysql1
    environment:
      - MYSQL_ROOT_PASSWORD=root
  replica1:
    image: mysql:8.0
    ports:
      - "13309:3306"
    volumes:
      - ./conf/mysql/replica1:/etc/mysql/conf.d
    networks:
      - backend
    environment:
      - MYSQL_ROOT_PASSWORD=root
  proxysql1:
    image: proxysql/proxysql:latest
    ports:
      - "16033:6033"
      - "16032:6032"
      - "16080:6080"
    volumes:
      - ./conf/proxysql/proxysql.cnf:/etc/proxysql.cnf
    depends_on:
      - mysql1
      - mysql2
      - mysql3
    networks:
      - frontend
      - backend
networks:
  frontend:
  backend:
